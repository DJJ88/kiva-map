<html>
  <head>
    <title>Script Progress: 99.47%</title>
    <style>
      
      body {
        background: #003f66; /* Old browsers */
        background: -moz-radial-gradient(center, ellipse cover,  #003f66 0%, #002033 100%); /* FF3.6+ */
        background: -webkit-radial-gradient(center, ellipse cover,  #003f66 0%,#002033 100%); /* Chrome10+,Safari5.1+ */
        background: radial-gradient(center, ellipse cover,  #003f66 0%,#002033 100%); /* W3C */
      }
      
      #content-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
      }
      
      #content {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 40em;
        height: 20em;
        margin-left: -20em;
        margin-top: -10em;
      }
      
      #progress-wrapper {
        position: relative;
        width: 100%;
        height: 2.5em;
        margin: 2em 0;
      }
      #progress-bar, #progress {
        position: absolute;
        height: 2.5em;
        border-radius: 0.5em;
      }
      #progress-bar {
        width: 100%;
        background-color: #282828;
        box-shadow: inset 0 0.1em 0.4em 0 rgba(0, 0, 0, 0.7), 0 0.1em 0 0 rgba(255, 255, 255, 0.15);
      }
      #progress {
        width: 99.47%;
        background: -webkit-linear-gradient(#4db03e, #2c6523);
        background: -moz-linear-gradient(#4db03e, #2c6523);
        background: linear-gradient(#4db03e, #2c6523);
        -webkit-border-radius: 0.5em;
        -moz-border-radius: 0.5em;
        border-radius: 0.5em;
      }
      
      #stats-above, #stats-below {
        font-size: 140%;
        font-family: Consolas;
      }
      
      .stat {
        margin: 0.8em 0;
        width: 100%;
        overflow: auto;
      }
      .stat .label, .stat .value {
        float: left;
      }
      .stat .label {
        margin-left: 1em;
        color: #999;
      }
      .stat .value {
        padding-left: 1em;
        color: #fff;
      }
      
      #stats-above .value {
        font-weight: bold;
      }
      #stats-above .running {
        color: #259917;
      }
      #stats-above .stopped {
        color: #ee1d06;
      }
      
      #footer {
        font-size: 14px;
        text-align: center;
        position: absolute;
        bottom: 1em;
        left: 50%;
        width: 20em;
        margin-left: -10em;
        color: #999;
      }
      #footer a {
        color: #fff;
        text-decoration: none;
        font-family: Arial;
      }
      #footer a:hover {
        text-decoration: underline;
      }
    </style>
    <script>
      var HOURS_INTERVAL = 12;
      
      window.onload = function() {
        var refreshTime = new Date();
        refreshTime.setHours((Math.floor(refreshTime.getHours() / HOURS_INTERVAL) + 1) * HOURS_INTERVAL);
        refreshTime.setMinutes(1);
        refreshTime.setSeconds(0);
        
        var f = function(waitTime) {
          setTimeout(function() {
            var currentTime = new Date();
            
            if(refreshTime < currentTime) {
              window.location.reload();
              return;
            }
            
            var msToRevisit, timeLeft;
            
            if(refreshTime - currentTime > 3600000) {
              msToRevisit = (refreshTime - currentTime) % 3600000;
              var hours = Math.floor((refreshTime - currentTime) / 3600000);
              if(hours > 1) {
                timeLeft = 'over ' + hours + ' hours';
              }
              else {
                timeLeft = 'over an hour';
              }
            }
            else {
              msToRevisit = (refreshTime - currentTime) % 60000;
              var minutes = Math.floor((refreshTime - currentTime) / 60000) + 1;
              timeLeft = minutes + ' minute' + (minutes != 1 ? 's' : '');
            }
            
            
            document.getElementById('next-update').innerHTML = timeLeft;
            
            f(msToRevisit);
          }, waitTime);
        };
        
        f(0);
      };
    </script>
  </head>
  <body>
    <div id="content-wrapper">
      <div id="content">
        <div id="stats-above">
          <div class="stat">
            <div class="label">Status:</div>
            <div class="value running">Running</div>
          </div>
          <div class="stat">
            <div class="label">Progress:</div>
            <div class="value">99.47%</div>
          </div>
          <div class="stat">
            <div class="label">Next update in:</div>
            <div id="next-update" class="value"></div>
          </div>
        </div>
        <div id="progress-wrapper">
          <div id="progress-bar"></div>
          <div id="progress"></div>
        </div>
        <div id="stats-below">
          <div class="stat">
            <div class="label">Loans processed:</div>
            <div class="value">410321</div>
          </div>
          <div class="stat">
            <div class="label">Unique lender locations:</div>
            <div class="value">36080</div>
          </div>
          <div class="stat">
            <div class="label">Unique loan locations:</div>
            <div class="value">946</div>
          </div>
        </div>
      </div>
    </div>
    <div id="footer">
      <a href="about.html">about</a> |
      <a href="https://github.com/sndurkin/kiva-map/commits/gh-pages">commit history</a>
    </div>
  </body>
</html>